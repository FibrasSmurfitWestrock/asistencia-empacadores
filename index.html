<body>
    <div class="titulo">ASISTENCIA EMPAQUE</div>
    <div class="subtitulo">Smurfit Westrock</div>

    <form id="formulario" novalidate>

        <button type="submit" id="boton-enviar">Enviar</button>
    </form>

    <div id="mensaje-enviado" style="display: none; text-align: center; margin-top: 2rem;">
        <h2>✅ ¡Registro enviado!</h2>
        <p>Gracias por registrar tu asistencia. Puedes cerrar esta ventana.</p>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const tienda = params.get("tienda") || "NO DEFINIDA";
        document.getElementById("tienda").value = tienda;

        const formulario = document.getElementById("formulario");
        const boton = document.getElementById("boton-enviar");
        const mensaje = document.getElementById("mensaje-enviado");

        formulario.addEventListener("submit", async (e) => {
            e.preventDefault();

            const nombre = formulario.nombre.value.trim();
            const tipo = formulario.tipo.value;

            if (!nombre || !tipo || !/^[A-Za-zÁÉÍÓÚáéíóúÑñ ]+$/.test(nombre)) {
                alert("Por favor completa correctamente el nombre (solo letras) y selecciona entrada o salida.");
                return;
            }

            boton.disabled = true;
            boton.textContent = "Enviando...";

            const datos = {
                nombre,
                tipo,
                carton: formulario.carton.value || "0",
                playo: formulario.playo.value || "0",
                comentarios: formulario.comentarios.value || "",
                tienda: formulario.tienda.value,
                fecha: new Date().toLocaleDateString(),
                hora: new Date().toLocaleTimeString()
            };

            try {
                await fetch("https://prod-113.westeurope.logic.azure.com:443/workflows/a3f5294a01a4464eb021d7aa066bc3d6/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=4KZ2tSmPoLS8ua76JjbQ-cZECg7LSLAtl1OysP9d6Ig", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(datos)
                });

                formulario.style.display = "none";
                mensaje.style.display = "block";
            } catch (error) {
                alert("Error al enviar. Intenta de nuevo.");
                boton.disabled = false;
                boton.textContent = "Enviar";
            }
        });
    </script>
</body>
</html>
